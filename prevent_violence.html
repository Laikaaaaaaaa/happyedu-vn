<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  
  <title>Phòng Chống Bạo Lực - HappyEdu VN</title>

  <script src="https://cdn.tailwindcss.com"></script>
  
  <link rel="icon" type="image/x-icon" href="logo/favicon.ico">
  <link rel="apple-touch-icon" href="logo/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="logo/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="logo/favicon-16x16.png">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  
  <style>
    * {
      transition: all 0.2s ease;
    }

    body {
      min-height: 100vh;
      background: #ffffff;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      color: #0F172A;
    }

    body::-webkit-scrollbar {
      display: none;
    }

    body {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .light-blue-bg {
      background-color: #E0F2FE;
    }
    
    .sidebar {
      position: fixed;
      left: -250px;
      top: 0;
      width: 250px;
      height: 100vh;
      background-color: #FFFFFF;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: left 0.2s ease;
      z-index: 1000;
      padding-top: 80px;
      overflow-y: auto;
    }

    .sidebar-user-info {
      padding: 0.75rem 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      background: #F8FAFC;
      border-radius: 16px;
      box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.05);
      margin: 0.75rem 0 0;
    }

    .sidebar-user-info strong {
      font-size: 0.95rem;
      color: #0F172A;
    }

    .sidebar-user-info span {
      font-size: 0.8rem;
      color: #475569;
      letter-spacing: 0.3px;
    }

    /* Active sidebar item styling */
    .sidebar-item-active {
      background-color: #DBEAFE !important;
      color: #1D4ED8 !important;
      font-weight: 700 !important;
    }
    
    .sidebar.active {
      left: 0;
    }
    
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.4);
      display: none;
      z-index: 999;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    @media (min-width: 769px) {
      .sidebar {
        visibility: hidden;
        pointer-events: none;
      }
      .sidebar-overlay {
        display: none !important;
      }
    }
    
    .sidebar-overlay.active {
      display: block;
      opacity: 1;
    }
    
    .logo-circle {
      width: 52px;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 14px;
      background: transparent;
      box-shadow: none;
    }

    .top-banner {
      background: #0F172A;
      color: white;
      text-transform: uppercase;
      letter-spacing: 3px;
      font-size: 0.8rem;
      text-align: center;
      padding: 0.65rem 1rem;
      font-weight: 600;
    }

    .nav-shell {
      background: #ffffff;
      border-bottom: 1px solid #E2E8F0;
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.04);
      padding: 1rem 1.5rem;
    }

    .nav-bar {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 800;
      font-size: 1.2rem;
      color: #0F172A;
    }

    .nav-utilities {
      display: flex;
      align-items: center;
      gap: 0.9rem;
    }

    .nav-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .nav-menu a {
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      font-weight: 600;
      color: #475569;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .nav-menu a:hover,
    .nav-menu a.active {
      background: #1D4ED8;
      color: white;
    }

    .user-pill {
      background: #F8FAFC;
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      color: #0F172A;
      font-weight: 600;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      border: 1px solid #E2E8F0;
    }

    .nav-toggle {
      display: none;
      border: 1px solid #E2E8F0;
      background: #ffffff;
      border-radius: 10px;
      padding: 0.4rem 0.65rem;
      font-size: 1.1rem;
      color: #0F172A;
    }

    .nav-toggle:hover {
      background: #F8FAFC;
    }

    @media (max-width: 900px) {
      .nav-bar {
        flex-wrap: wrap;
        gap: 0.75rem;
      }
      .nav-menu {
        flex-basis: 100%;
        order: 3;
        justify-content: flex-start;
        gap: 0.65rem;
      }
      .nav-utilities {
        margin-left: auto;
      }
      .nav-menu a {
        font-size: 0.85rem;
        padding: 0.35rem 0.75rem;
        white-space: nowrap;
      }
    }

    @media (max-width: 768px) {
      .nav-bar {
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
        gap: 0.65rem;
        flex-wrap: nowrap;
      }
      .nav-brand {
        order: 2;
        margin-left: auto;
        gap: 0.5rem;
      }
      .nav-utilities {
        order: 1;
        flex: 1 1 auto;
        min-width: 0;
        justify-content: flex-start;
      }
      .nav-menu {
        display: none;
      }
      .nav-toggle {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        order: 0;
        margin-right: 0.4rem;
      }
      .user-pill {
        display: none;
      }
    }
    
    .card-shadow {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .card-base {
      background-color: #ffffff;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.04);
      border: 1px solid #E2E8F0;
      transition: box-shadow 0.3s ease, border-color 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .card-base::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }

    .card-base:hover {
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      border-color: #CBD5F5;
    }

    .card-base:hover::before {
      left: 100%;
    }

    .btn-primary {
      padding: 0.6rem 1.25rem;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.875rem;
      border: 1px solid #0F172A;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background-color: #0F172A;
      color: #ffffff;
    }

    .btn-primary:hover {
      background-color: #1E293B;
      transform: translateY(-1px);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid #CBD5F5;
      color: #0F172A;
    }

    .btn-outline:hover {
      border-color: #94A3B8;
      background-color: #F8FAFC;
    }

    .feature-section {
      padding: 2.5rem 2rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 320px;
      border-radius: 20px;
      background: #ffffff;
    }

    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 1.25rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 4rem;
      width: 4rem;
      border-radius: 12px;
      background-color: #F8FAFC;
    }

    .btn-sos {
      background: #DC2626;
      border-color: #B91C1C;
      box-shadow: 0 12px 30px rgba(220, 38, 38, 0.25);
    }

    .btn-sos:hover {
      background: #B91C1C;
    }

    .feature-title {
      font-size: 1.35rem;
      font-weight: 700;
      color: #0F172A;
      margin-bottom: 0.6rem;
    }

    .feature-description {
      font-size: 1.05rem;
      color: #1E293B;
      opacity: 0.75;
      margin-bottom: 1.5rem;
      line-height: 1.7;
      flex-grow: 1;
    }

    main > div {
      animation: fadeInUp 0.5s ease;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1.5rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    @media (max-width: 1024px) {
      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }

    .feature-section a {
      border-radius: 999px;
      font-weight: 600;
      border: 1px solid #E2E8F0;
      background: #ffffff;
      color: #0F172A;
    }

    .feature-section a:hover {
      transform: translateY(-2px);
      border-color: #94A3B8;
    }

    .hero-card {
      text-align: center;
    }

    .hero-tagline {
      font-size: 0.85rem;
      letter-spacing: 4px;
      color: #94A3B8;
      text-transform: uppercase;
    }

    .hero-title {
      font-size: clamp(1.5rem, 4vw, 2.25rem);
      font-weight: 800;
      color: #0F172A;
      margin-top: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .hero-desc {
      max-width: 520px;
      margin: 0.5rem auto 1.5rem;
      color: #475569;
      line-height: 1.6;
    }

    .hero-actions {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
    }

    .hero-actions .btn-primary,
    .hero-actions .btn-outline {
      min-width: 140px;
      border-radius: 999px;
    }
    
      .hero-sos-wrap {
        margin-top: 1.75rem;
        display: flex;
        justify-content: center;
      }
    
      .hero-sos-wrap button {
        font-size: 1.1rem;
        font-weight: 600;
        padding: 1rem 2rem;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

    @media (max-width: 768px) {
      .hero-title {
        font-size: 2rem;
      }
    }

    .utility-row {
      margin-top: 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }

    .utility-row .btn-primary {
      border-radius: 14px;
      min-width: 180px;
      font-size: 1rem;
    }

    /* Wiki Layout Styles */
    .wiki-container {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    .wiki-sidebar {
      position: sticky;
      top: 155px;
      height: fit-content;
      background: #ffffff;
      border-radius: 16px;
      padding: 1.5rem;
      border: 1px solid #E2E8F0;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.04);
    }

    .wiki-sidebar h3 {
      font-size: 1rem;
      font-weight: 700;
      color: #0F172A;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #E2E8F0;
    }

    .wiki-sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .wiki-sidebar li {
      margin-bottom: 0.25rem;
    }

    .wiki-sidebar a {
      display: block;
      padding: 0.6rem 0.75rem;
      color: #475569;
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .wiki-sidebar a:hover {
      background: #E0F2FE;
      color: #1D4ED8;
    }

    .wiki-content {
      background: #ffffff;
      border-radius: 16px;
      padding: 2rem;
      border: 1px solid #E2E8F0;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.04);
    }

    .wiki-content h1 {
      font-size: 2rem;
      font-weight: 800;
      color: #0F172A;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #E2E8F0;
    }

    .wiki-content h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1E293B;
      margin: 2rem 0 1rem;
    }

    .wiki-content h3 {
      font-size: 1.15rem;
      font-weight: 600;
      color: #334155;
      margin: 1.5rem 0 0.75rem;
    }

    .wiki-content p {
      color: #475569;
      line-height: 1.8;
      margin-bottom: 1rem;
    }

    .wiki-content section {
      margin-bottom: 2rem;
      scroll-margin-top: 120px;
    }

    .info-alert {
      background: #E0F2FE;
      border: 1px solid #BAE6FD;
      border-radius: 12px;
      padding: 1rem 1.25rem;
      margin: 1rem 0;
      color: #0369A1;
    }

    .video-slider {
      position: relative;
      width: 100%;
      max-width: 640px;
      margin: 1.5rem auto;
      border-radius: 12px;
      overflow: hidden;
      background: #0F172A;
    }

    .video-slider video {
      width: 100%;
      display: block;
    }

    .video-switch {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .video-switch:hover {
      background: #ffffff;
      transform: translateY(-50%) scale(1.1);
    }

    .video-prev {
      left: 10px;
    }

    .video-next {
      right: 10px;
    }

    /* Warning/Emergency Alert Box - Clean */
    .warning-alert {
      background: #FFFBEB;
      border-left: 4px solid #F59E0B;
      border-radius: 0 8px 8px 0;
      padding: 1rem 1.25rem;
      margin: 1.5rem 0;
    }

    .warning-alert strong {
      display: block;
      color: #92400E;
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .warning-alert ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .warning-alert li {
      padding: 0.4rem 0;
      color: #78350F;
      font-size: 0.9rem;
    }

    .warning-alert li strong {
      display: inline;
      color: #DC2626;
      font-size: inherit;
      margin-bottom: 0;
    }

    /* Method Box - Simple */
    .method-box {
      padding: 1rem 0;
      border-bottom: 1px solid #F1F5F9;
    }

    .method-box:last-child {
      border-bottom: none;
    }

    .method-box h4 {
      color: #0F172A;
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 0.35rem;
      display: flex;
      align-items: center;
    }

    .method-box h4 i {
      color: #1D4ED8;
      margin-right: 0.5rem;
      width: 18px;
    }

    .method-box p {
      color: #64748B;
      margin: 0;
      line-height: 1.6;
      font-size: 0.9rem;
      padding-left: 1.65rem;
    }

    /* Wiki content list and ordered list styling */
    .wiki-content ul,
    .wiki-content ol {
      margin: 1rem 0;
      padding-left: 1.5rem;
    }

    .wiki-content ul li,
    .wiki-content ol li {
      color: #475569;
      padding: 0.35rem 0;
      line-height: 1.6;
      font-size: 0.9rem;
    }

    /* SOS Link - Simple text link */
    .sos-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: #DC2626;
      font-weight: 600;
      text-decoration: none;
      padding: 0.5rem 0;
      transition: color 0.2s ease;
    }

    .sos-link:hover {
      color: #B91C1C;
      text-decoration: underline;
    }

    .sos-link i {
      font-size: 1.1rem;
    }

    @media (max-width: 900px) {
      .wiki-container {
        grid-template-columns: 1fr;
        padding: 1rem;
      }

      .wiki-sidebar {
        display: none;
      }

      .wiki-content {
        order: 1;
      }

      .warning-alert {
        padding: 1.25rem;
      }

      .warning-alert li {
        padding: 0.75rem;
        font-size: 0.9rem;
      }

      .sos-action-box {
        flex-direction: column;
        text-align: center;
      }

      .sos-text h4 {
        justify-content: center;
      }
    }
  </style>
</head>
<body class="light-blue-bg">
  <script>
    (function enforceAuth() {
      const path = window.location.pathname.split('/').pop() || 'index.html';
      const publicPages = ['login.html', 'register.html', 'otp.html'];
      const isPublic = publicPages.includes(path);
      const isLoggedIn = !!sessionStorage.getItem('user_id');

      if (!isLoggedIn && !isPublic) {
        window.location.replace('login.html');
      }

      if (isLoggedIn && (path === 'login.html' || path === 'register.html')) {
        window.location.replace('index.html');
      }
    })();
  </script>

  <!-- Sidebar Overlay -->
  <div id="sidebar-overlay" class="sidebar-overlay"></div>

  <!-- Sidebar -->
  <nav id="sidebar" class="sidebar">
    <div class="p-6 border-b border-gray-200">
      <h3 class="text-lg font-bold text-gray-800">Menu</h3>
      <div id="sidebar-user-block" class="sidebar-user-info">
        <strong id="sidebar-user-name">--</strong>
        <span id="sidebar-user-id">--</span>
      </div>
    </div>
    <ul class="space-y-2 p-4">
      <!-- Not logged in menu -->
      <li id="sidebar-login" class="block">
        <a href="login.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-blue-600 hover:bg-blue-50 font-medium transition-colors">
          <i class="fas fa-sign-in-alt" style="width: 20px; text-align: center;"></i> Đăng nhập
        </a>
      </li>
      <li id="sidebar-register" class="block">
        <a href="register.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-blue-600 hover:bg-blue-50 font-medium transition-colors">
          <i class="fas fa-user-plus" style="width: 20px; text-align: center;"></i> Đăng ký
        </a>
      </li>

      <!-- Logged in menu -->
      <li id="sidebar-home" class="hidden">
        <a href="index.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-blue-600 hover:bg-blue-50 font-medium transition-colors">
          <i class="fas fa-home" style="width: 20px; text-align: center;"></i> Trang Chủ
        </a>
      </li>
      <li id="sidebar-profile" class="hidden">
        <a href="profile.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-blue-600 hover:bg-blue-50 font-medium transition-colors">
          <i class="fas fa-user" style="width: 20px; text-align: center;"></i> Hồ Sơ
        </a>
      </li>
      <li id="sidebar-assessment" class="hidden">
        <a href="assessment.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-blue-600 hover:bg-blue-50 font-medium transition-colors">
          <i class="fas fa-clipboard-list" style="width: 20px; text-align: center;"></i> Đánh giá
        </a>
      </li>
      <li id="sidebar-chat" class="hidden">
        <a href="conversation.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-blue-600 hover:bg-blue-50 font-medium transition-colors">
          <i class="fas fa-comments" style="width: 20px; text-align: center;"></i> Trò Chuyện
        </a>
      </li>
      <li id="sidebar-prevent" class="hidden">
        <a href="prevent_violence.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-blue-600 hover:bg-blue-50 font-medium transition-colors sidebar-item-active">
          <i class="fas fa-shield-alt" style="width: 20px; text-align: center;"></i> Phòng Chống
        </a>
      </li>
      <li id="sidebar-sos" class="hidden">
        <button onclick="triggerSOS()" class="w-full flex items-center gap-3 text-left px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 font-medium transition-colors">
          <i class="fas fa-exclamation-triangle" style="width: 20px; text-align: center;"></i> SOS
        </button>
      </li>
      <li id="sidebar-logout" class="hidden border-t border-gray-200 pt-2 mt-2">
        <button onclick="logoutUser()" class="w-full flex items-center gap-3 text-left px-4 py-3 rounded-lg text-gray-600 hover:bg-gray-100 font-medium transition-colors">
          <i class="fas fa-sign-out-alt" style="width: 20px; text-align: center;"></i> Đăng xuất
        </button>
      </li>
    </ul>
  </nav>

  <!-- Header -->
  <header class="sticky top-0 z-50">
    <div class="top-banner">Hệ thống hỗ trợ học đường</div>
    <div class="nav-shell">
      <div class="nav-bar">
        <div class="nav-brand">
          <div class="logo-circle">
            <img src="logo/android-chrome-192x192.png" alt="Logo" class="w-10 h-10 object-cover">
          </div>
          HappyEdu VN
        </div>

        <nav class="nav-menu">
          <a href="index.html">Trang Chủ</a>
          <a href="assessment.html">Đánh Giá</a>
          <a href="conversation.html">Trò Chuyện</a>
          <a href="prevent_violence.html" class="active">Phòng Chống</a>
          <a href="profile.html">Hồ Sơ</a>
        </nav>

        <div class="nav-utilities">
          <div class="user-pill" id="user-pill">
            <i class="fas fa-circle text-[8px]"></i>
            <span id="user-name">--</span>
            <span class="text-xs opacity-80" id="user-id-display">--</span>
          </div>
          <button id="mobile-menu-toggle" class="nav-toggle" aria-label="Mở menu">
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <div class="wiki-container">
      <!-- Sidebar Navigation -->
      <aside class="wiki-sidebar">
        <h3><i class="fas fa-list mr-2"></i>Mục Lục</h3>
        <ul>
          <li><a href="#overview">Tổng Quan</a></li>
          <li><a href="#definition">Định Nghĩa</a></li>
          <li><a href="#types">Hình Thức Bạo Lực</a></li>
          <li><a href="#signs">Dấu Hiệu Nhận Biết</a></li>
          <li><a href="#prevention">Phòng Chống</a></li>
          <li><a href="#support">Hỗ Trợ & Tài Nguyên</a></li>
          <li><a href="#emergency">Liên Hệ Khẩn Cấp</a></li>
        </ul>
      </aside>

      <!-- Main Content -->
      <article class="wiki-content">
        <h1>Phòng Chống Bạo Lực Học Đường</h1>

        <section id="overview">
          <h2>Tổng Quan</h2>
          <p>Bạo lực học đường là một vấn đề nghiêm trọng ảnh hưởng đến sức khỏe thể chất, tinh thần và sự phát triển của hàng triệu học sinh trên toàn thế giới. Nó không chỉ gây tổn hại cho nạn nhân mà còn ảnh hưởng đến toàn bộ môi trường học tập, làm giảm chất lượng giáo dục.</p>
          <div class="video-slider" aria-label="Video hướng dẫn phòng chống bạo lực">
            <button id="prev-video" class="video-switch video-prev" aria-label="Video trước">
              <i class="fas fa-chevron-left"></i>
            </button>
            <video id="prevent-video" preload="metadata" poster="logo/android-chrome-512x512.png" muted autoplay playsinline>
              Trình duyệt của bạn không hỗ trợ video.
            </video>
            <button id="next-video" class="video-switch video-next" aria-label="Video tiếp theo">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <p>Trang này cung cấp thông tin toàn diện về các phương pháp phòng chống bạo lực học đường, giúp học sinh, giáo viên, và phụ huynh nhận biết và xử lý các tình huống liên quan đến bạo lực.</p>
        </section>

        <section id="definition">
          <h2>Định Nghĩa</h2>
          <p>Bạo lực học đường bao gồm tất cả các hành vi có ý định gây tổn hại thể chất hoặc tinh thần cho học sinh, xảy ra trong môi trường học tập. Bạo lực có thể xảy ra giữa học sinh với nhau, hoặc giữa giáo viên và học sinh, hoặc từ phụ huynh hướng về trường học.</p>
          <div class="info-alert">
            <strong>ℹ️ Thông Tin Quan Trọng:</strong> Bạo lực học đường không chỉ là bạo lực thể chất. Nó bao gồm bạo lực tâm lý, quấy rối tình dục, bắt nạt (bullying), và bạo lực trực tuyến (cyberbullying).
          </div>
        </section>

        <section id="types">
          <h2>Hình Thức Bạo Lực</h2>
          <p>Bạo lực học đường có nhiều hình thức khác nhau, mỗi hình thức đều gây tổn hại đáng kể cho nạn nhân:</p>

          <h3>1. Bạo Lực Thể Chất</h3>
          <p>Đánh, đá, tát, sử dụng vũ khí, hoặc bất kỳ hành động nào gây thương tích thể chất cho nạn nhân.</p>

          <h3>2. Bạo Lực Tâm Lý</h3>
          <p>Đe dọa, làm nhục, cô lập, chế giễu, và mọi hình thức tấn công về tinh thần, gây tổn thương tâm lý lâu dài.</p>

          <h3>3. Bắt Nạt (Bullying)</h3>
          <p>Hành vi quấy rối lặp lại, có chủ đích, với sự mất cân bằng về quyền lực giữa kẻ bắt nạt và nạn nhân.</p>

          <h3>4. Bạo Lực Trực Tuyến (Cyberbullying)</h3>
          <p>Quấy rối thông qua mạng xã hội, tin nhắn, email. Có thể xảy ra 24/7 và dễ lan truyền với tốc độ nhanh.</p>

          <h3>5. Quấy Rối Tình Dục</h3>
          <p>Nhận xét, cử chỉ có tính chất tình dục không mong muốn, gây khó chịu hoặc sợ hãi cho nạn nhân.</p>

          <h3>6. Phân Biệt Đối Xử</h3>
          <p>Hành động phân biệt dựa trên chủng tộc, tôn giáo, nguồn gốc dân tộc, hoặc các đặc điểm cá nhân khác.</p>
        </section>

        <section id="signs">
          <h2>Dấu Hiệu Nhận Biết</h2>
          <p>Các dấu hiệu sau có thể cho thấy một học sinh đang bị bạo lực:</p>
          <ul>
            <li>Không muốn đi học hoặc thường xuyên vắng mặt không lý do chính đáng</li>
            <li>Có vết thương, chấn thương, hoặc bầm tím không rõ nguyên nhân</li>
            <li>Tâm trạng thay đổi đột ngột, trở nên im lặng, gắt gỏng, hoặc dễ cáu gắt</li>
            <li>Mất đồ vật, sách vở, hoặc tiền thường xuyên</li>
            <li>Không muốn nói chuyện về trường học hoặc bạn bè</li>
            <li>Mức độ học tập giảm sút đáng kể</li>
            <li>Ăn ngủ thay đổi, mất ngủ hoặc ăn quá ít</li>
            <li>Có những vết xước hoặc dấu tự gây hại trên cơ thể</li>
            <li>Sợ hãi khi sử dụng điện thoại hoặc máy tính</li>
            <li>Rút lui khỏi hoạt động xã hội hoặc bạn bè</li>
          </ul>
        </section>

        <section id="prevention">
          <h2>Phương Pháp Phòng Chống</h2>
          
          <div class="method-box">
            <h4><i class="fas fa-lightbulb mr-2"></i>1. Nhận Thức & Giáo Dục</h4>
            <p>Tăng cường nhận thức về bạo lực học đường thông qua các chương trình giáo dục, hội thảo, và các bài giảng về sức khỏe tinh thần. Đây là bước đầu tiên và quan trọng nhất.</p>
          </div>

          <div class="method-box">
            <h4><i class="fas fa-users mr-2"></i>2. Xây Dựng Cộng Đồng An Toàn</h4>
            <p>Tạo môi trường an toàn nơi học sinh có thể báo cáo bạo lực mà không sợ bị trả thù. Khuyến khích bạn bè can thiệp khi chứng kiến bạo lực.</p>
          </div>

          <div class="method-box">
            <h4><i class="fas fa-book mr-2"></i>3. Chính Sách Rõ Ràng</h4>
            <p>Xây dựng các chính sách chống bạo lực rõ ràng với các hình phạt công bằng và hỗ trợ cho cả nạn nhân lẫn người phạm lỗi.</p>
          </div>

          <div class="method-box">
            <h4><i class="fas fa-heart mr-2"></i>4. Hỗ Trợ Tâm Lý</h4>
            <p>Cung cấp dịch vụ tư vấn tâm lý cho học sinh bị tổn thương, những người bạo lực, và những người chứng kiến bạo lực.</p>
          </div>

          <div class="method-box">
            <h4><i class="fas fa-video mr-2"></i>5. Giám Sát & Phòng Ngừa</h4>
            <p>Giám sát các khu vực nguy hiểm trong trường học, đặc biệt là nhà vệ sinh, sân chơi, và phòng thay đồ. Sự hiện diện của người lớn có thể ngăn chặn bạo lực.</p>
          </div>

          <div class="method-box">
            <h4><i class="fas fa-handshake mr-2"></i>6. Hợp Tác Với Gia Đình</h4>
            <p>Liên hệ thường xuyên với phụ huynh để cùng xây dựng môi trường an toàn cho trẻ em. Cha mẹ đóng vai trò quan trọng trong việc phòng chống bạo lực.</p>
          </div>
        </section>

        <section id="support">
          <h2>Hỗ Trợ & Tài Nguyên</h2>
          <p>Các tài nguyên hỗ trợ bao gồm:</p>
          <ul>
            <li>Hướng dẫn chi tiết cho giáo viên và quản lý trường học</li>
            <li>Tài liệu giáo dục cho học sinh về cách đối phó với bạo lực</li>
            <li>Video hướng dẫn cách báo cáo bạo lực</li>
            <li>Danh sách các tổ chức hỗ trợ và hotline tư vấn</li>
            <li>Hướng dẫn cho phụ huynh nhận biết dấu hiệu bạo lực</li>
          </ul>
        </section>

        <section id="emergency">
          <h2>Liên Hệ Khẩn Cấp</h2>
          <div class="warning-alert">
            <strong>⚠️ Nếu bạn hoặc bạn bè của bạn đang gặp nguy hiểm, hãy hành động ngay!</strong>
            <ul>
              <li><strong>113</strong> - Công An (Khẩn cấp)</li>
              <li><strong>111</strong> - Tổng đài Bảo vệ Trẻ em Quốc gia</li>
              <li><strong>1800 599 920</strong> - Tư vấn Tâm lý Học đường (miễn phí)</li>
            </ul>
          </div>
        </section>
      </article>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      initSidebarToggle();
      loadUserInfo();
      loadPreventVideoPlaylist();

      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          if (href && href !== '#') {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          }
        });
      });
    });

    function initSidebarToggle() {
      const menuToggle = document.getElementById('mobile-menu-toggle');
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebar-overlay');
      if (!sidebar || !sidebarOverlay) return;

      if (menuToggle) {
        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('active');
          sidebarOverlay.classList.toggle('active');
        });
      }

      sidebarOverlay.addEventListener('click', closeSidebar);

      const sidebarLinks = sidebar.querySelectorAll('a, button');
      sidebarLinks.forEach(link => link.addEventListener('click', closeSidebar));

      const desktopQuery = window.matchMedia('(min-width: 769px)');
      const handleDesktopMatch = (e) => {
        if (e.matches) closeSidebar();
      };

      if (desktopQuery.addEventListener) {
        desktopQuery.addEventListener('change', handleDesktopMatch);
      } else if (desktopQuery.addListener) {
        desktopQuery.addListener(handleDesktopMatch);
      }

      if (desktopQuery.matches) {
        closeSidebar();
      }
    }

    function closeSidebar() {
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebar-overlay');
      if (sidebar) sidebar.classList.remove('active');
      if (sidebarOverlay) sidebarOverlay.classList.remove('active');
    }

    function loadUserInfo() {
      const userID = sessionStorage.getItem('user_id') || null;
      const userName = sessionStorage.getItem('user_name') || 'Chưa đăng nhập';
      const userRole = sessionStorage.getItem('user_role') || 'HS';
      const isLoggedIn = !!userID;
      const displayId = isLoggedIn ? `${userID} - ${userRole}` : '000000 - HS';

      const userNameEl = document.getElementById('user-name');
      const userIdEl = document.getElementById('user-id-display');
      const sidebarNameEl = document.getElementById('sidebar-user-name');
      const sidebarIdEl = document.getElementById('sidebar-user-id');

      if (userNameEl) userNameEl.textContent = userName;
      if (userIdEl) userIdEl.textContent = displayId;
      if (sidebarNameEl) sidebarNameEl.textContent = userName;
      if (sidebarIdEl) sidebarIdEl.textContent = displayId;

      updateSidebarMenu(isLoggedIn);
    }

    function updateSidebarMenu(isLoggedIn) {
      const loginItem = document.getElementById('sidebar-login');
      const registerItem = document.getElementById('sidebar-register');
      const homeItem = document.getElementById('sidebar-home');
      const profileItem = document.getElementById('sidebar-profile');
      const assessmentItem = document.getElementById('sidebar-assessment');
      const chatItem = document.getElementById('sidebar-chat');
      const preventItem = document.getElementById('sidebar-prevent');
      const sosItem = document.getElementById('sidebar-sos');
      const logoutItem = document.getElementById('sidebar-logout');
      const toggle = (item, show) => {
        if (!item) return;
        item.classList.toggle('hidden', !show);
      };

      if (isLoggedIn) {
        toggle(loginItem, false);
        toggle(registerItem, false);
        toggle(homeItem, true);
        toggle(profileItem, true);
        toggle(assessmentItem, true);
        toggle(chatItem, true);
        toggle(preventItem, true);
        toggle(sosItem, true);
        toggle(logoutItem, true);
      } else {
        toggle(loginItem, true);
        toggle(registerItem, true);
        toggle(homeItem, false);
        toggle(profileItem, false);
        toggle(assessmentItem, false);
        toggle(chatItem, false);
        toggle(preventItem, false);
        toggle(sosItem, false);
        toggle(logoutItem, false);
      }
    }


    // Highlight current page in sidebar
    function highlightActiveSidebarItem() {
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      
      // Remove active class from all sidebar links
      const allLinks = document.querySelectorAll('.sidebar a, .sidebar button[onclick*="triggerSOS"]');
      allLinks.forEach(link => link.classList.remove('active'));
      
      // Add active class to current page link
      if (currentPage === 'index.html' || currentPage === '') {
        const homeLink = document.querySelector('#sidebar-home a');
        if (homeLink) homeLink.classList.add('active');
      } else if (currentPage === 'profile.html') {
        const profileLink = document.querySelector('#sidebar-profile a');
        if (profileLink) profileLink.classList.add('active');
      } else if (currentPage === 'assessment.html') {
        const assessmentLink = document.querySelector('#sidebar-assessment a');
        if (assessmentLink) assessmentLink.classList.add('active');
      } else if (currentPage === 'conversation.html' || currentPage === 'chat.html') {
        const chatLink = document.querySelector('#sidebar-chat a');
        if (chatLink) chatLink.classList.add('active');
      } else if (currentPage === 'prevent_violence.html') {
        const preventLink = document.querySelector('#sidebar-prevent a');
        if (preventLink) preventLink.classList.add('active');
      }
    }



    let preventVideoPlaylist = [];
    let preventCurrentVideoIndex = 0;

    // Tự động tải danh sách video từ server
    async function loadPreventVideoPlaylist() {
      try {
        const response = await fetch('/api/videos/list');
        if (response.ok) {
          const data = await response.json();
          preventVideoPlaylist = data.videos || [];
          console.log('Videos from API:', preventVideoPlaylist);
        }
      } catch (error) {
        console.log('API error, using fallback video loading...', error);
        // Fallback: tạo danh sách từ những video hiện có
        preventVideoPlaylist = await detectLocalVideos();
      }
      
      if (preventVideoPlaylist.length > 0) {
        console.log('Loaded playlist with', preventVideoPlaylist.length, 'videos');
        initPreventVideoSlider();
      } else {
        console.warn('No videos found, using hardcoded fallback');
        // Hardcoded fallback nếu tất cả đều thất bại - ưu tiên MP4
        preventVideoPlaylist = [
          'video/videoplayback.mp4',
          'video/videoplayback (1).mp4',
          'video/videoplayback (2).mp4',
          'video/videoplayback (3).mp4',
          'video/videoplayback (4).mp4'
        ];
        initPreventVideoSlider();
      }
    }

    // Phát hiện video tại địa chỉ cụ thể (fallback)
    async function detectLocalVideos() {
      // Cố gắng tìm video, ưu tiên mp4 vì webm có thể chưa được convert
      const videoPatterns = [
        ['video/videoplayback.mp4', 'video/videoplayback (1).mp4', 'video/videoplayback (2).mp4', 'video/videoplayback (3).mp4', 'video/videoplayback (4).mp4'],
        ['video/videoplayback.webm', 'video/videoplayback (1).webm', 'video/videoplayback (2).webm', 'video/videoplayback (3).webm', 'video/videoplayback (4).webm']
      ];
      
      for (const pattern of videoPatterns) {
        const existingVideos = [];
        for (const file of pattern) {
          try {
            // Thử load bằng GET request thay vì HEAD (tương thích hơn)
            const response = await fetch(file, { 
              method: 'GET',
              headers: { 'Range': 'bytes=0-1' }
            });
            if (response.ok || response.status === 206) { // 206 = Partial Content
              existingVideos.push(file);
            }
          } catch (error) {
            // File không tồn tại hoặc không thể truy cập
          }
        }
        
        if (existingVideos.length > 0) {
          console.log('Found videos:', existingVideos);
          return existingVideos;
        }
      }
      
      console.log('No local videos detected');
      return [];
    }

    function initPreventVideoSlider() {
      const videoEl = document.getElementById('prevent-video');
      if (!videoEl) return;
      const prevBtn = document.getElementById('prev-video');
      const nextBtn = document.getElementById('next-video');
      const sliderEl = document.querySelector('.video-slider');

      const setSource = () => {
        const item = preventVideoPlaylist[preventCurrentVideoIndex];
        if (!item) {
          console.error('No video item at index', preventCurrentVideoIndex);
          return;
        }
        
        console.log('Loading video:', item);
        
        // Xóa tất cả source hiện tại
        const existingSources = videoEl.querySelectorAll('source');
        existingSources.forEach(src => src.remove());
        
        // Xác định loại video dựa vào extension
        let videoType = 'video/mp4';
        if (item.toLowerCase().endsWith('.webm')) {
          videoType = 'video/webm';
        } else if (item.toLowerCase().endsWith('.mp4')) {
          videoType = 'video/mp4';
        }
        
        console.log('Video type:', videoType);
        
        // Tạo source element mới
        const sourceEl = document.createElement('source');
        sourceEl.src = item;
        sourceEl.type = videoType;
        sourceEl.onerror = () => {
          console.error('Error loading video source:', item);
        };
        videoEl.appendChild(sourceEl);
        
        videoEl.onerror = () => {
          console.error('Error playing video:', item);
        };
        
        videoEl.onloadedmetadata = () => {
          console.log('Video loaded successfully:', item);
        };
        
        videoEl.load();
        videoEl.play().catch(error => {
          console.error('Error playing video:', error);
        });
      };

      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          preventCurrentVideoIndex = (preventCurrentVideoIndex - 1 + preventVideoPlaylist.length) % preventVideoPlaylist.length;
          setSource();
        });
      }

      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          preventCurrentVideoIndex = (preventCurrentVideoIndex + 1) % preventVideoPlaylist.length;
          setSource();
        });
      }

      const toggleVideoControls = (show) => {
        videoEl.controls = show;
        if (show) {
          videoEl.setAttribute('controls', 'controls');
        } else {
          videoEl.removeAttribute('controls');
        }
      };

      if (sliderEl) {
        sliderEl.addEventListener('mouseenter', () => toggleVideoControls(true));
        sliderEl.addEventListener('mouseleave', () => toggleVideoControls(false));
      }

      toggleVideoControls(false);

      setSource();
    }

    function logoutUser() {
      if (confirm('Bạn chắc chắn muốn đăng xuất?')) {
        sessionStorage.removeItem('user_id');
        sessionStorage.removeItem('user_name');
        sessionStorage.removeItem('user_role');
        sessionStorage.removeItem('user_email');
        closeSidebar();
        updateSidebarMenu(false);
        loadUserInfo();
        alert('Đã đăng xuất thành công!');
        // Force redirect to login
        window.location.replace('login.html');
      }
    }

    function triggerSOS() {
      const userID = sessionStorage.getItem('user_id');
      const userName = sessionStorage.getItem('user_name');
      const userEmail = sessionStorage.getItem('user_email');
      const userRole = sessionStorage.getItem('user_role');
      const userPhone = sessionStorage.getItem('user_phone');
      const userClass = sessionStorage.getItem('user_class');
      
      // Check if user is logged in
      if (!userID || !userEmail) {
        alert('Bạn phải đăng nhập trước khi gửi SOS!');
        window.location.href = 'login.html';
        return;
      }
      
      // Check if user is valid (not default/placeholder values)
      if (userID === 'Unknown' || userEmail === 'unknown@email.com') {
        alert('Thông tin đăng nhập không hợp lệ. Vui lòng đăng nhập lại.');
        sessionStorage.clear();
        window.location.href = 'login.html';
        return;
      }
      
      // Allow students (HS), teachers (GV), and parents (PH) to send SOS
      if (!['HS', 'GV', 'PH'].includes(userRole)) {
        alert('Chỉ học sinh, giáo viên và phụ huynh mới có thể gửi báo cáo SOS!');
        return;
      }
      
      if (confirm('Bạn chắc chắn muốn gửi tín hiệu SOS?')) {
        // Get current location
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const location = `Vĩ độ: ${position.coords.latitude}, Kinh độ: ${position.coords.longitude}`;
              sendSOSRequest(userID, userName, userEmail, userPhone, userClass, location, userRole);
            },
            (error) => {
              console.log('Geolocation error:', error);
              sendSOSRequest(userID, userName, userEmail, userPhone, userClass, 'Không xác định', userRole);
            }
          );
        } else {
          sendSOSRequest(userID, userName, userEmail, userPhone, userClass, 'Không xác định', userRole);
        }
      }
    }

    function sendSOSRequest(userId, userName, userEmail, userPhone, userClass, location, userRole) {
      // Determine user type label
      let userTypeLabel = 'Học sinh';
      if (userRole === 'GV') userTypeLabel = 'Giáo viên';
      else if (userRole === 'PH') userTypeLabel = 'Phụ huynh';
      
      // Use non-null values or empty string defaults
      const payload = {
        student_id: userId || '',
        student_name: userName || 'N/A',
        student_email: userEmail || '',
        student_phone: userPhone || '',
        student_class: userClass || '',
        location: location || 'Không xác định',
        message: `Báo cáo khẩn từ ${userTypeLabel} - Phòng Chống Bạo Lực`
      };
      
      console.log('Sending SOS with payload:', payload);
      
      fetch('/api/sos/send', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(res => {
        console.log('Response status:', res.status);
        if (!res.ok) {
          return res.json().then(data => {
            throw new Error(data.error || `HTTP ${res.status}: ${res.statusText}`);
          }).catch(() => {
            throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          });
        }
        return res.json();
      })
      .then(data => {
        console.log('SOS response:', data);
        if (data.success) {
          alert('Tín hiệu SOS đã được gửi thành công! Vui lòng chờ hỗ trợ từ quản trị viên.');
        } else {
          alert('Lỗi khi gửi SOS: ' + (data.error || 'Unknown error'));
        }
      })
      .catch(error => {
        console.error('SOS Error:', error);
        alert('Lỗi khi gửi SOS: ' + error.message);
      })
      .finally(closeSidebar);
    }
  </script>
</body>
</html>
